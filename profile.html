<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Profile ‚Ä¢ Globaltrends</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
body{margin:0;font-family:-apple-system,system-ui;background:#fff}
.nav{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff;z-index:1000}
.nav-right{display:flex;align-items:center;gap:18px;position:relative}

.logout-dropdown{position:absolute;top:35px;right:0;background:#fff;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,.15);display:none;flex-direction:column;min-width:160px;overflow:hidden;border:1px solid #eee;z-index:2000}
.logout-item{padding:12px 15px;font-size:14px;font-weight:600;cursor:pointer;display:flex;gap:10px;align-items:center}
.logout-item:active{background:#f5f5f5}
.logout-item.red{color:#ff2d55}

.profile-hdr{text-align:center;padding:20px}
.p-avatar-container{width:85px;height:85px;border-radius:50%;background:#e0e0e0;display:flex;align-items:center;justify-content:center;margin:0 auto;overflow:hidden}
.p-avatar-container i{font-size:40px;color:#000}
.p-avatar-img{width:100%;height:100%;object-fit:cover;display:none}

.username-row{font-size:18px;font-weight:700;margin-top:10px;display:flex;justify-content:center;gap:6px}
.p-bio{font-size:14px;color:#555;margin:6px auto 12px;max-width:80%}

.stats{display:flex;justify-content:center;gap:30px;margin:15px 0}
.stat-val{font-weight:800;font-size:17px}
.stat-lbl{font-size:12px;color:#888}

.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:#eee}
.grid-item{aspect-ratio:9/16;background:#000;position:relative;overflow:hidden}
.grid-item img,.grid-item video{width:100%;height:100%;object-fit:cover}

.media-indicator{position:absolute;top:6px;right:6px;background:rgba(0,0,0,.5);color:#fff;font-size:12px;padding:2px 6px;border-radius:4px}

#fsPlayer{position:fixed;inset:0;background:#000;display:none;z-index:5000}
#mediaContent{width:100%;height:100%;display:flex;align-items:center;justify-content:center}
.fs-img,.fs-video{max-width:100%;max-height:100%;object-fit:contain}

.fs-close{position:absolute;top:20px;left:20px;color:#fff;font-size:26px;z-index:5100}
.fs-dots{position:absolute;top:20px;right:20px;color:#fff;font-size:22px;z-index:5100}

.fs-info{position:absolute;bottom:30px;left:15px;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.8)}
.fs-user-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.fs-avatar{width:34px;height:34px;border-radius:50%;border:1.5px solid #fff;object-fit:cover}

.fs-actions{position:absolute;right:15px;bottom:100px;color:#fff;text-align:center}
.fs-actions i{font-size:30px;cursor:pointer}
.liked{color:#ff2d55}

#delMenu{position:absolute;top:60px;right:20px;background:#fff;color:#ff2d55;font-weight:bold;padding:12px 20px;border-radius:8px;display:none;z-index:5200}

.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#000;color:#fff;padding:14px 20px;border-radius:24px;display:none;z-index:9999;text-align:center}
.toast button{margin:8px 6px 0;padding:6px 14px;border:none;border-radius:14px;font-weight:600}
.toast-ok{background:#ff2d55;color:#fff}
.toast-cancel{background:#444;color:#fff}
</style>
</head>

<body>

<div id="toast" class="toast"></div>

<!-- FULLSCREEN -->
<div id="fsPlayer">
<i class="fa fa-times fs-close" onclick="closeFS()"></i>
<i class="fa fa-ellipsis-v fs-dots" onclick="toggleDelMenu()"></i>
<div id="delMenu" onclick="askDelete()">Delete post</div>
<div id="mediaContent"></div>

<div class="fs-info">
  <div class="fs-user-row">
    <img id="fsAv" class="fs-avatar">
    <span id="fsUn"></span>
    <span id="fsBadge"></span>
  </div>
  <div id="fsCap"></div>
</div>

<div class="fs-actions">
  <i id="likeBtn" class="fa fa-heart" onclick="toggleLike()"></i>
  <div id="likeCount">0</div>
</div>
</div>

<!-- NAV -->
<div class="nav">
<i class="fa fa-arrow-left" onclick="history.back()"></i>
<b>Profile</b>

<div class="nav-right">
<i class="fa fa-share-alt" onclick="shareProfile()"></i>
<i class="fa fa-bell" onclick="location.href='notifications.html'"></i>
<i class="fa fa-ellipsis-v" onclick="toggleMenu()"></i>

<div id="menu" class="logout-dropdown">
  <div class="logout-item" onclick="location.href='dashboard.html'">
    <i class="fa fa-chart-line"></i> View dashboard
  </div>
  <div class="logout-item red" onclick="logout()">
    <i class="fa fa-sign-out-alt"></i> Log out
  </div>
</div>
</div>
</div>

<!-- PROFILE -->
<div class="profile-hdr">
<div class="p-avatar-container">
<i id="defaultIcon" class="fa fa-user"></i>
<img id="pAv" class="p-avatar-img">
</div>

<div id="pUn" class="username-row"></div>
<div id="pBio" class="p-bio"></div>

<div class="stats">
<div><span id="subs" class="stat-val">0</span><div class="stat-lbl">Subscribers</div></div>
<div><span id="likes" class="stat-val">0</span><div class="stat-lbl">Total Likes</div></div>
</div>
</div>

<div id="grid" class="grid"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
 "https://spnvgymmrlyqtfrbjjsg.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwbnZneW1tcmx5cXRmcmJqanNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MzM4ODMsImV4cCI6MjA4MzUwOTg4M30.EAgw94HZsHa21YLcTuV0GLAlUeRZN-ixKA0QeD5oPNI"
);

let myId = localStorage.getItem("user_id") || localStorage.getItem("anon_id");
if(!myId){myId="anon_"+Math.random().toString(36).slice(2);localStorage.setItem("anon_id",myId)}

const profileId = new URLSearchParams(location.search).get("id") || myId;
let posts=[],currentPost=null;

const toast = msg => {toastEl.innerHTML=msg;toastEl.style.display="block"}
const hideToast =()=>toastEl.style.display="none"

window.toggleMenu=()=>menu.style.display=menu.style.display==="flex"?"none":"flex";
window.shareProfile=()=>navigator.share?navigator.share({url:location.href}):navigator.clipboard.writeText(location.href)

window.logout=()=>{
 toast(`Log out?<br>
 <button class="toast-cancel" onclick="hideToast()">Cancel</button>
 <button class="toast-ok" onclick="confirmLogout()">Log out</button>`)
}
window.confirmLogout=()=>{localStorage.clear();location.href="https://globaltrends56.blogspot.com"}

async function load(){
 const {data:profile}=await supabase.from("profiles").select("*").eq("id",profileId).single();
 const {data:p}=await supabase.from("posts").select("*").eq("user_id",profileId).order("created_at",{ascending:false});
 posts=p||[];

 if(profile.avatar_url){pAv.src=profile.avatar_url;pAv.style.display="block";defaultIcon.style.display="none"}
 pUn.innerHTML="@"+profile.username+(profile.verified?` <i class="fa fa-check-circle" style="color:#1DA1F2"></i>`:"")
 pBio.innerText=profile.bio||""

 subs.innerText=profile.subscribers||0;
 likes.innerText=posts.reduce((a,b)=>a+(b.likes||0),0)

 grid.innerHTML=posts.map(v=>`
 <div class="grid-item" onclick="openFS('${v.id}')">
 <div class="media-indicator">${v.media_type==="photo"?"üñºÔ∏è":"üéûÔ∏è"}</div>
 ${v.media_type==="photo"?`<img src="${v.media_urls[0]}">`:`<video src="${v.video_url}#t=0.1" muted></video>`}
 </div>`).join("")
}

window.openFS=id=>{
 currentPost=posts.find(p=>p.id===id)
 fsPlayer.style.display="block"
 mediaContent.innerHTML=""
 if(currentPost.media_type==="photo"){
  const img=document.createElement("img")
  img.src=currentPost.media_urls[0]
  img.className="fs-img"
  mediaContent.appendChild(img)
 }else{
  const v=document.createElement("video")
  v.src=currentPost.video_url
  v.autoplay=true;v.loop=true;v.playsInline=true
  v.className="fs-video"
  mediaContent.appendChild(v)
 }
 fsAv.src=pAv.src
 fsUn.innerText=pUn.innerText
 fsBadge.innerHTML=pUn.innerHTML.includes("check-circle")?'<i class="fa fa-check-circle" style="color:#1DA1F2"></i>':""
 fsCap.innerText=currentPost.caption||""
 likeCount.innerText=currentPost.likes||0
}

window.toggleLike=async()=>{
 let liked=localStorage.getItem("liked_"+currentPost.id)
 let count=currentPost.likes||0
 if(!liked){count++;likeBtn.classList.add("liked");localStorage.setItem("liked_"+currentPost.id,1)}
 else{count--;likeBtn.classList.remove("liked");localStorage.removeItem("liked_"+currentPost.id)}
 currentPost.likes=count
 likeCount.innerText=count
 await supabase.from("posts").update({likes:count}).eq("id",currentPost.id)
}

window.toggleDelMenu=()=>delMenu.style.display=delMenu.style.display==="block"?"none":"block"
window.askDelete=()=>toast(`Delete post?<br>
<button class="toast-cancel" onclick="hideToast()">Cancel</button>
<button class="toast-ok" onclick="deletePost()">Delete</button>`)

window.deletePost=async()=>{
 await supabase.from("posts").delete().eq("id",currentPost.id)
 location.reload()
}

window.closeFS=()=>{fsPlayer.style.display="none"}

load()
</script>
</body>
  </html>

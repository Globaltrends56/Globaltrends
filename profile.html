<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Profile ‚Ä¢ Globaltrends</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<style>
:root { --accent:#1877f2; --bg:#fff; --grey:#f2f2f2; }
body { margin:0; font-family:-apple-system,system-ui; background:#fff; }

.nav { display:flex; justify-content:space-between; padding:12px 18px; border-bottom:1px solid #eee; position:sticky; top:0; background:#fff; z-index:1000; }
.nav-right { display:flex; gap:18px; }

.profile-hdr { text-align:center; padding:25px 20px; }
.p-avatar-box { width:90px; height:90px; border-radius:50%; background:#eee; margin:auto; overflow:hidden; }
.p-avatar-box img { width:100%; height:100%; object-fit:cover; }

.username-tag { font-size:20px; font-weight:800; display:flex; justify-content:center; align-items:center; gap:6px; }

.verify {
    width:16px; height:16px;
}

.stats-row { display:flex; justify-content:center; gap:40px; margin:20px 0; }
.stat-v { font-weight:800; }

.grid { display:grid; grid-template-columns:repeat(3,1fr); gap:1px; background:#eee; }
.grid-item { aspect-ratio:1/1; background:#000; position:relative; overflow:hidden; }

.media-badge {
    position:absolute; top:6px; right:6px;
    background:rgba(0,0,0,.6);
    color:#fff; font-size:11px;
    padding:3px 6px; border-radius:6px;
}

#fsPlayer {
    position:fixed; inset:0; background:#000;
    display:none; z-index:9999;
}

.fs-top {
    position:absolute; top:20px; left:20px;
    color:#fff; display:flex; gap:12px; align-items:center;
}

.fs-top img { width:36px; height:36px; border-radius:50%; object-fit:cover; }

.fs-menu {
    position:absolute; top:20px; right:20px;
    color:#fff; font-size:22px;
}

.fs-caption {
    position:absolute; bottom:30px; left:20px;
    color:#fff; font-size:14px;
}

</style>
</head>
<body>

<div class="nav">
    <i class="fa fa-chevron-left" onclick="history.back()"></i>
    <b>Profile</b>
    <div class="nav-right">
        <i id="notifBtn" class="fa fa-bell" onclick="location.href='notification.html'"></i>
        <i class="fa fa-sign-out-alt" onclick="logout()"></i>
    </div>
</div>

<div class="profile-hdr">
    <div class="p-avatar-box"><img id="pAv"></div>
    <div id="pUn" class="username-tag"></div>
    <div id="pBio"></div>

    <div class="stats-row">
        <div><span id="sCount" class="stat-v">0</span><div>Subscribers</div></div>
        <div><span id="lCount" class="stat-v">0</span><div>Likes</div></div>
    </div>
</div>

<div id="grid" class="grid"></div>

<div id="fsPlayer">
    <div class="fs-top">
        <img id="fsAv">
        <div id="fsUn"></div>
    </div>

    <i class="fa fa-ellipsis-v fs-menu" id="fsMenu"></i>

    <div id="fsMedia" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;"></div>

    <div id="fsCaption" class="fs-caption"></div>

    <i class="fa fa-times" style="position:absolute;bottom:20px;right:20px;color:#fff;font-size:26px" onclick="closeFS()"></i>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient("https://spnvgymmrlyqtfrbjjsg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwbnZneW1tcmx5cXRmcmJqanNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MzM4ODMsImV4cCI6MjA4MzUwOTg4M30.EAgw94HZsHa21YLcTuV0GLAlUeRZN-ixKA0QeD5oPNI");

const myId = localStorage.getItem("user_id");
const profId = new URLSearchParams(location.search).get("id") || myId;
let fsVideo = null;

function verifySVG(){
    return `<svg class="verify" viewBox="0 0 24 24"><path fill="#1877f2" d="M12 2l2.3 2.3 3.3-.5.6 3.3 3 1.6-1.6 3 .5 3.3-3.3.6L12 22l-2.3-2.3-3.3.5-.6-3.3-3-1.6 1.6-3-.5-3.3 3.3-.6z"/><path fill="#fff" d="M10.2 14.5l-2.3-2.3 1.4-1.4 1 1 3.4-3.4 1.4 1.4z"/></svg>`;
}

async function load(){
    const { data:p } = await supabase.from("profiles").select("*").eq("id",profId).single();
    const { data:v } = await supabase.from("posts").select("*").eq("user_id",profId);

    document.getElementById("pAv").src = p.avatar_url || "";
    document.getElementById("pUn").innerHTML =
        `@${p.username} ${p.is_verified ? verifySVG() : ""}`;
    document.getElementById("pBio").innerText = p.bio || "";

    document.getElementById("grid").innerHTML = v.map(i=>`
        <div class="grid-item" onclick='openFS(${JSON.stringify(i)})'>
            <div class="media-badge">${i.media_type==="photo"?"üñºÔ∏è":"üéûÔ∏è"}</div>
            ${i.media_type==="photo"
                ? `<img src="${i.media_urls[0]}" style="width:100%;height:100%;object-fit:cover">`
                : `<video src="${i.video_url}#t=0.1" muted></video>`
            }
        </div>
    `).join("");
}

window.openFS = (post)=>{
    document.getElementById("fsPlayer").style.display="block";
    document.getElementById("fsAv").src=document.getElementById("pAv").src;
    document.getElementById("fsUn").innerHTML=document.getElementById("pUn").innerHTML;
    document.getElementById("fsCaption").innerText=post.caption||"";

    const c=document.getElementById("fsMedia");
    c.innerHTML="";

    if(post.media_type==="video"){
        fsVideo=document.createElement("video");
        fsVideo.src=post.video_url;
        fsVideo.autoplay=true;
        fsVideo.controls=true;
        fsVideo.playsInline=true;
        c.appendChild(fsVideo);
    } else {
        const img=document.createElement("img");
        img.src=post.media_urls[0];
        img.style.maxWidth="100%";
        c.appendChild(img);
    }

    document.getElementById("fsMenu").onclick=()=>{
        if(myId===post.user_id){
            if(confirm("Delete post?")){
                supabase.from("posts").delete().eq("id",post.id);
                closeFS();
                load();
            }
        }
    };
};

window.closeFS=()=>{
    if(fsVideo){ fsVideo.pause(); fsVideo.src=""; fsVideo=null; }
    document.getElementById("fsPlayer").style.display="none";
};

window.logout=()=>{
    localStorage.clear();
    location.href="https://globaltrends56.blogspot.com";
};

load();
</script>
</body>
    </html>

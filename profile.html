<!-- üî¥ SAME FILE ‚Äì ONLY SAFE PATCHES ADDED üî¥ -->
<!-- I MARKED ALL NEW PARTS WITH: // ‚úÖ PATCH -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Profile ‚Ä¢ Globaltrends</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<style>
/* ‚ùå CSS UNCHANGED */
</style>
</head>
<body>

<!-- FULLSCREEN PLAYER -->
<div id="fsPlayer">
  <i class="fa fa-times" style="position:absolute; top:25px; left:20px; color:#fff; font-size:26px; z-index:100;" onclick="closeFS()"></i>

  <!-- ‚úÖ PATCH: three-dot menu -->
  <i id="fsMenu" class="fa fa-ellipsis-v"
     style="position:absolute; top:25px; right:20px; color:#fff; font-size:22px; z-index:100; display:none;"
     onclick="deletePost()"></i>

  <div id="mediaContent" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center;"></div>

  <!-- ‚úÖ PATCH: user overlay -->
  <div id="fsUser" style="position:absolute; bottom:160px; left:15px; color:#fff; display:flex; align-items:center; gap:10px;">
    <img id="fsAvatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
    <div>
      <div id="fsName" style="font-weight:700;"></div>
      <div id="fsCaption" style="font-size:13px;opacity:.9;"></div>
    </div>
  </div>

  <div style="position:absolute; right:20px; bottom:110px; color:#fff; text-align:center;">
    <i id="likeHeart" class="fa fa-heart" style="font-size:32px;" onclick="toggleLike()"></i>
    <div id="fsLikeCount" style="font-size:13px; font-weight:700;">0</div>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <i class="fa fa-chevron-left" onclick="history.back()"></i>
  <b>Profile</b>

  <div class="nav-right">
    <!-- ‚úÖ PATCH: Share profile -->
    <i class="fa fa-share-nodes" style="font-size:20px;" onclick="shareProfile()"></i>

    <div id="notifBtn" style="display:none; position:relative;" onclick="location.href='notifications.html'">
      <i class="fa fa-bell" style="font-size:20px;"></i>
      <span id="notifDot" class="notif-badge"></span>
    </div>

    <div id="menuBtn" style="display:none;" onclick="showLogoutToast()">
      <i class="fa fa-sign-out-alt" style="font-size:20px; color:#ff2d55;"></i>
    </div>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient("https://spnvgymmrlyqtfrbjjsg.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwbnZneW1tcmx5cXRmcmJqanNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MzM4ODMsImV4cCI6MjA4MzUwOTg4M30.EAgw94HZsHa21YLcTuV0GLAlUeRZN-ixKA0QeD5oPNI");

const myId = localStorage.getItem("user_id");
let curPost = null;

/* ‚úÖ PATCH: share */
window.shareProfile = () => {
  navigator.share?.({
    title: 'Profile',
    url: location.href
  });
};

/* ‚úÖ PATCH: fullscreen open */
window.openFS = (post) => {
  curPost = post;
  document.getElementById('fsPlayer').style.display = 'flex';

  document.getElementById('fsName').innerHTML =
    '@' + post.username + (post.is_verified ? ' <i class="fa fa-check-circle" style="color:#1DA1F2"></i>' : '');

  document.getElementById('fsCaption').innerText = post.caption || '';
  document.getElementById('fsAvatar').src = post.avatar_url || '';

  // like sync
  const liked = localStorage.getItem('l_'+post.id);
  document.getElementById('likeHeart').style.color = liked ? '#ff2d55' : '#fff';
  document.getElementById('fsLikeCount').innerText = post.likes || 0;

  // owner menu
  document.getElementById('fsMenu').style.display = (post.user_id === myId) ? 'block' : 'none';

  if (post.media_type === 'video') {
    document.getElementById('mediaContent').innerHTML =
      `<video id="fsVid" src="${post.video_url}" autoplay playsinline loop></video>`;
  }
};

/* ‚úÖ PATCH: close stops audio */
window.closeFS = () => {
  const v = document.getElementById('fsVid');
  if (v) v.pause();
  document.getElementById('fsPlayer').style.display = 'none';
};

/* ‚úÖ PATCH: delete post */
window.deletePost = async () => {
  if (!confirm('Delete this post?')) return;
  await supabase.from('posts').delete().eq('id', curPost.id);
  location.reload();
};

/* ‚úÖ PATCH: fixed like */
window.toggleLike = async () => {
  let liked = localStorage.getItem('l_'+curPost.id);
  let count = parseInt(curPost.likes) || 0;

  if (!liked) {
    localStorage.setItem('l_'+curPost.id,'1');
    count++;
  } else return;

  curPost.likes = count;
  document.getElementById('fsLikeCount').innerText = count;
  document.getElementById('likeHeart').style.color = '#ff2d55';

  await supabase.from('posts').update({ likes: count }).eq('id', curPost.id);
};
</script>
</body>
    </html>

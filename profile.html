<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profile | Globaltrends</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <style>
        body { margin:0; font-family:-apple-system, sans-serif; background:#fff; overflow-x: hidden; }
        .nav { display:flex; justify-content:space-between; align-items:center; padding:12px 18px; border-bottom:1px solid #eee; position:sticky; top:0; background:#fff; z-index: 1000; }
        .profile-hdr { text-align:center; padding:20px; }
        .p-avatar { width: 90px; height: 90px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; margin: 0 auto; display: block; }
        .stats { display:flex; justify-content:center; gap:40px; margin:20px 0; }
        .stat-item { text-align:center; }
        .stat-val { font-weight:800; font-size:18px; display:block; }
        .stat-lbl { color:#888; font-size:12px; }
        .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background:#eee; }
        .grid-item { aspect-ratio: 1/1; background:#000; position: relative; overflow: hidden; cursor: pointer; }
        .grid-item img, .grid-item video { width: 100%; height: 100%; object-fit: cover; }
        .btn-edit { background:#f2f2f2; border:none; padding:10px 30px; border-radius:8px; font-weight:600; font-size:14px; margin-top:10px; cursor:pointer; }
        #fsPlayer { position:fixed; inset:0; background:#000; z-index:9999; display:none; flex-direction:column; }
        .fs-close { position:absolute; top:20px; left:20px; color:#fff; font-size:24px; z-index:100; }
    </style>
</head>
<body>
<div class="nav"><i class="fa fa-chevron-left" onclick="history.back()"></i><b id="navTitle">Profile</b><i class="fa fa-ellipsis-v"></i></div>
<div class="profile-hdr">
    <img id="pAv" class="p-avatar" src="https://via.placeholder.com/150">
    <div id="pUn" style="font-weight:700; font-size:18px; margin-top:10px;">@username</div>
    <div id="pBio" style="font-size:14px; color:#555; margin-top:5px;">No bio yet.</div>
    <div class="stats">
        <div class="stat-item"><span class="stat-val" id="sCount">0</span><span class="stat-lbl">Subscribers</span></div>
        <div class="stat-item"><span class="stat-val" id="lCount">0</span><span class="stat-lbl">Likes</span></div>
    </div>
    <button id="editBtn" class="btn-edit" style="display:none" onclick="location.href='edit-profile.html'">Edit Profile</button>
</div>
<div id="grid" class="grid"></div>
<div id="fsPlayer">
    <i class="fa fa-times fs-close" onclick="document.getElementById('fsPlayer').style.display='none'"></i>
    <div id="fsContent" style="height:100%; display:flex; align-items:center; justify-content:center;"></div>
</div>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient("https://spnvgymmrlyqtfrbjjsg.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwbnZneW1tcmx5cXRmcmJqanNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MzM4ODMsImV4cCI6MjA4MzUwOTg4M30.EAgw94HZsHa21YLcTuV0GLAlUeRZN-ixKA0QeD5oPNI");
const myId = localStorage.getItem("user_id");
const profileId = new URLSearchParams(location.search).get("id") || myId;

async function checkBan() {
    if (!myId) return;
    const { data } = await supabase.from('profiles').select('status').eq('id', myId).single();
    if (data?.status === 'suspended') window.location.href = 'suspended.html';
}

async function loadProfile() {
    const { data: p } = await supabase.from('profiles').select('*').eq('id', profileId).single();
    if(!p) return;
    document.getElementById('pAv').src = p.avatar_url || 'https://via.placeholder.com/150';
    document.getElementById('pUn').innerText = '@' + p.username;
    document.getElementById('pBio').innerText = p.bio || '';
    if(myId === profileId) document.getElementById('editBtn').style.display = 'inline-block';

    const { data: posts } = await supabase.from('posts').select('*').eq('user_id', profileId).order('created_at', {ascending:false});
    const g = document.getElementById('grid');
    g.innerHTML = posts.map(v => `
        <div class="grid-item" onclick="openFS('${v.media_type === 'photo' ? v.media_urls[0] : v.video_url}', '${v.media_type}')">
            ${v.media_type === 'photo' ? `<img src="${v.media_urls[0]}">` : `<video src="${v.video_url}#t=0.5"></video>`}
        </div>
    `).join('');
}

window.openFS = (url, type) => {
    const p = document.getElementById('fsPlayer');
    const c = document.getElementById('fsContent');
    p.style.display = 'flex';
    c.innerHTML = type === 'photo' ? `<img src="${url}" style="max-width:100%; max-height:100%">` : `<video src="${url}" controls autoplay style="width:100%"></video>`;
}
checkBan();
loadProfile();
</script>
</body>
</html>
